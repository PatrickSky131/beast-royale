# Beast Royale é¡¹ç›®å‘½ä»¤æŒ‡å—
# ä½¿ç”¨æ–¹æ³•ï¼šå¤åˆ¶ç²˜è´´ä»¥ä¸‹å‘½ä»¤åˆ°ç»ˆç«¯æ‰§è¡Œ

# ========================================
# ğŸš€ å¯åŠ¨æœåŠ¡
# ========================================

# 1. å¯åŠ¨ngrokéš§é“ï¼ˆè·å–å…¬ç½‘åœ°å€ï¼‰
./start-ngrok.sh

# 2. å¯åŠ¨åç«¯æœåŠ¡
cd backend && ./start.sh

# 3. å¯åŠ¨å‰ç«¯æœåŠ¡
cd frontend && ./start.sh

# ========================================
# ğŸ›‘ åœæ­¢æœåŠ¡
# ========================================

# 1. åœæ­¢å‰ç«¯æœåŠ¡
cd frontend && ./stop.sh

# 2. åœæ­¢åç«¯æœåŠ¡
cd backend && ./stop.sh

# 3. åœæ­¢ngrokéš§é“
./stop-ngrok.sh

# ========================================
# âš¡ ä¸€é”®æ“ä½œ
# ========================================

# ä¸€é”®å¯åŠ¨æ‰€æœ‰æœåŠ¡
./start-ngrok.sh && cd backend && ./start.sh && cd ../frontend && ./start.sh

# ä¸€é”®åœæ­¢æ‰€æœ‰æœåŠ¡
cd frontend && ./stop.sh && cd ../backend && ./stop.sh && cd .. && ./stop-ngrok.sh

# ========================================
# ğŸ“Š æ£€æŸ¥æœåŠ¡çŠ¶æ€
# ========================================

# æ£€æŸ¥ç«¯å£å ç”¨
lsof -i :5173  # å‰ç«¯ç«¯å£
lsof -i :8080  # åç«¯ç«¯å£
lsof -i :4040  # ngrokç«¯å£

# æ£€æŸ¥è¿›ç¨‹
ps aux | grep ngrok
ps aux | grep "npm run dev"
ps aux | grep "go run"

# æŸ¥çœ‹æ‰€æœ‰ç›¸å…³è¿›ç¨‹
ps aux | grep -E "(ngrok|vite|go run|main.go)"

# ========================================
# ğŸŒ è®¿é—®åœ°å€
# ========================================

# å‰ç«¯æœ¬åœ°åœ°å€
open http://localhost:5173

# åç«¯APIåœ°å€
open http://localhost:8080

# ngrokç®¡ç†ç•Œé¢
open http://localhost:4040

# ========================================
# ğŸ”§ å¼€å‘è°ƒè¯•
# ========================================

# æŸ¥çœ‹ngrokæ—¥å¿—
tail -f ngrok.log

# æŸ¥çœ‹å‰ç«¯ç¯å¢ƒå˜é‡
cat frontend/.env

# æŸ¥çœ‹åç«¯é…ç½®
cat backend/config.yaml

# é‡æ–°æ„å»ºå‰ç«¯
cd frontend && npm run build

# é‡æ–°æ„å»ºåç«¯
cd backend && go build -o beast-royale-backend main.go

# ========================================
# ğŸ§¹ æ¸…ç†æ“ä½œ
# ========================================

# æ¸…ç†æ‰€æœ‰PIDæ–‡ä»¶
rm -f .ngrok.pid backend/.backend.pid frontend/.frontend.pid

# æ¸…ç†æ—¥å¿—æ–‡ä»¶
rm -f ngrok.log

# å¼ºåˆ¶åœæ­¢æ‰€æœ‰ç›¸å…³è¿›ç¨‹
pkill -f ngrok
pkill -f "npm run dev"
pkill -f "go run"
pkill -f "main.go"

# ========================================
# ğŸ“ å¸¸ç”¨ç»„åˆå‘½ä»¤
# ========================================

# é‡å¯å‰ç«¯ï¼ˆä¿æŒåç«¯è¿è¡Œï¼‰
cd frontend && ./stop.sh && ./start.sh

# é‡å¯åç«¯ï¼ˆä¿æŒå‰ç«¯è¿è¡Œï¼‰
cd backend && ./stop.sh && ./start.sh

# é‡å¯ngrokï¼ˆä¿æŒå‰åç«¯è¿è¡Œï¼‰
./stop-ngrok.sh && ./start-ngrok.sh

# æ£€æŸ¥æ‰€æœ‰æœåŠ¡çŠ¶æ€
echo "=== æœåŠ¡çŠ¶æ€æ£€æŸ¥ ===" && \
echo "å‰ç«¯ç«¯å£5173:" && lsof -i :5173 && \
echo "åç«¯ç«¯å£8080:" && lsof -i :8080 && \
echo "ngrokç«¯å£4040:" && lsof -i :4040 